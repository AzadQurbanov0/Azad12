<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Para Tƒ±klama Oyunu</title>
<style>
:root {
  --bg1: #0f0c29; --bg2: #302b63; --bg3: #24243e;
  --card: rgba(255,255,255,0.06); --glass: rgba(255,255,255,0.12);
  --text: #f8fafc; --text-muted: #a9a9a9;
  --accent: #22c55e; --red: #dc2626; --blue: #3b82f6; --purple: #8b5cf6;
  --yellow: #f59e0b;
  --border-color: rgba(255,255,255,0.1);
  --energy-color: #38bdf8;
}
*{box-sizing:border-box;margin:0;padding:0; font-family: system-ui, -apple-system, sans-serif;}
html, body {
    height: 100%;
    overflow: hidden; /* S…ôhif…ônin scroll olmasƒ±nƒ± …ông…ôll…ôyir */
}
body{
  color: var(--text); background:linear-gradient(135deg,var(--bg1),var(--bg2) 50%,var(--bg3));
  display: flex; flex-direction: column; align-items: center; justify-content: space-between;
  text-align: center;
  user-select: none; /* M…ôtn se√ßiml…ôrini baƒülayƒ±r */
}
.hidden { display: none !important; }

/* Main Game Area */
.game-container {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding-bottom: 80px; /* Footer √º√ß√ºn bo≈üluq */
}

.page { display: none; width: 100%; height: 100%; flex-direction: column; align-items: center; padding: 15px; animation: fadeIn 0.5s ease; }
.page.active { display: flex; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

#main-page { justify-content: center; text-align: center; }
.user-greeting { font-size: 1.1rem; font-weight: 600; opacity: .9; margin: 20px 0; }

.balance-display { margin-bottom: 20px; }
.balance-value {
    font-size: clamp(2.5rem, 10vw, 4rem);
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}
.balance-value img { width: clamp(30px, 8vw, 45px); }

.clickable-area {
    width: min(70vw, 280px);
    aspect-ratio: 1/1;
    border-radius: 50%;
    display: grid;
    place-items: center;
    cursor: pointer;
    background: radial-gradient(circle at 55% 45%, rgba(255,255,255,0.2), transparent 70%), #302b63;
    box-shadow: 0 10px 30px rgba(0,0,0,0.4), inset 0 2px 3px rgba(255,255,255,0.15);
    transition: transform 0.1s ease;
}
.clickable-area:active { transform: scale(0.95); }
.clickable-area .icon { font-size: clamp(5rem, 25vw, 10rem); filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3)); }
  <style continue>
/* Energy Bar */
.energy-section {
    width: 90%;
    max-width: 400px;
    margin: 20px auto 0;
}
.energy-text {
    font-size: 1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-bottom: 10px;
}
.energy-bar-container {
    width: 100%;
    height: 12px;
    background-color: rgba(0,0,0,0.3);
    border-radius: 6px;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.1);
}
.energy-bar-fill {
    height: 100%;
    width: 100%;
    background: var(--energy-color);
    border-radius: 6px;
    transition: width 0.3s ease;
    box-shadow: 0 0 10px var(--energy-color);
}

.profit-display {
    margin-top: 15px;
    font-size: 0.9rem;
    color: var(--text-muted);
}


/* Birja/Upgrades Page */
.page-header { font-size: 1.8rem; font-weight: 700; margin-bottom: 20px; text-align: center; }
.tabs { display: flex; border-bottom: 2px solid var(--border-color); margin-bottom: 20px; justify-content: center; flex-wrap: wrap; }
.tab { padding: 10px 20px; cursor: pointer; font-size: 1rem; font-weight: bold; color: var(--text-muted); border-bottom: 3px solid transparent; }
.tab.active { color: var(--text); border-bottom-color: var(--accent); }

#upgrade-cards-container {
    width: 100%;
    max-width: 500px;
    height: calc(100% - 150px); /* Adjust height based on header and tabs */
    overflow-y: auto;
    padding: 5px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.upgrade-card {
    background: var(--card);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 15px;
    display: flex;
    align-items: center;
    gap: 15px;
    text-align: left;
}
.upgrade-card .icon { font-size: 2.5rem; }
.upgrade-card .details { flex-grow: 1; }
.upgrade-card .name { font-weight: 600; font-size: 1.1rem; }
.upgrade-card .meta { font-size: 0.85rem; color: var(--text-muted); margin-top: 4px; }
.upgrade-card .price { font-weight: bold; color: var(--yellow); }

.btn-upgrade {
    padding: 10px 18px;
    border: none;
    border-radius: 8px;
    background: var(--accent);
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s;
}
.btn-upgrade:disabled {
    background-color: #555;
    cursor: not-allowed;
}

  <style continue>
/* Footer Navigation */
footer {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: var(--card);
    backdrop-filter: blur(10px);
    display: flex;
    justify-content: space-around;
    padding: 10px 0 15px 0;
    z-index: 1001;
    border-top: 1px solid var(--border-color);
}
.nav-item {
    color: var(--text);
    text-decoration: none;
    text-align: center;
    font-size: 0.75rem;
    padding: 4px 12px;
    border-radius: 8px;
    transition: background 0.2s ease;
    cursor:pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}
.nav-item .icon { font-size: 1.5rem; display: block; }
.nav-item.active { color: var(--accent); }


/* Modal */
.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    display: flex; align-items: center; justify-content: center;
    z-index: 9999;
}
.modal-content {
    background: linear-gradient(135deg,var(--bg1),var(--bg2));
    padding: 30px; border-radius: 12px; text-align: center; color: var(--text);
    width: min(90vw, 350px);
}
.modal-content h3 { margin-bottom: 15px; }
.modal-content p { margin-bottom: 25px; line-height: 1.5; }
.modal-button {
    padding: 10px 20px; font-size:1rem; border:none;
    border-radius:8px; cursor:pointer; background: var(--accent); color: white;
}
</style>
</head>
<body>
  <div class="game-container">
    <div id="main-page" class="page active">
        <div class="user-greeting" id="user-greeting-text">Y√ºkl…ônir...</div>

        <div class="balance-display">
             <div class="balance-value">
                <img src="https://i.imgur.com/aJ3Ew2s.png" alt="Coin">
                <span id="balance">0</span>
            </div>
        </div>

        <div class="clickable-area" id="clickable-area">
            <div class="icon">üí∞</div>
        </div>

        <div class="energy-section">
            <div class="energy-text">
                ‚ö° <span id="energy-text-value">0/0</span>
            </div>
            <div class="energy-bar-container">
                <div class="energy-bar-fill" id="energy-bar"></div>
            </div>
        </div>
        
        <div class="profit-display">
            Saatlƒ±q g…ôlir: <span id="profit-per-hour">0</span>
        </div>
    </div>
        <div id="birja-page" class="page">
        <h2 class="page-header">Yenil…ôm…ôl…ôr</h2>
        <div class="tabs">
            <div class="tab active" data-category="pr_team">PR & Team</div>
            <div class="tab" data-category="markets">Markets</div>
            <div class="tab" data-category="legal">Legal</div>
            <div class="tab" data-category="specials">Specials</div>
        </div>
        <div id="upgrade-cards-container">
            <p>Y√ºkl…ônir...</p>
        </div>
    </div>
    
    <div id="leaderboard-page" class="page">
         <h2 class="page-header">Liderl…ôr C…ôdv…ôli</h2>
         <p>Tezlikl…ô...</p>
    </div>

</div> ```
---

### **Hƒ∞SS∆è 6/12: HTML Body (Footer v…ô Modal)**

```html
<footer>
    <a class="nav-item active" data-page="main-page"><span class="icon">üè†</span>∆èsas</a>
    <a class="nav-item" data-page="birja-page"><span class="icon">üìà</span>Birja</a>
    <a class="nav-item" data-page="leaderboard-page"><span class="icon">üèÖ</span>Liderl…ôr</a>
</footer>

<div class="modal-overlay hidden" id="offline-earnings-modal">
    <div class="modal-content">
        <h3>Xo≈ü G…ôldin!</h3>
        <p id="offline-earnings-text">Siz oyunda olmadƒ±ƒüƒ±nƒ±z m√ºdd…ôtd…ô qazanc …ôld…ô etdiniz!</p>
        <button class="modal-button" id="close-modal-btn">∆èla!</button>
    </div>
</div>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database-compat.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<script>
// Hƒ∞SS∆è 7: Skript Ba≈ülanƒüƒ±cƒ± v…ô Firebase Konfiqurasiyasƒ±

const firebaseConfig = {
    // BURAYA √ñZ FIREBASE KONFƒ∞QURASƒ∞YA M∆èLUMATLARINIZI YAPI≈ûDIRIN
    apiKey: "...",
    authDomain: "...",
    databaseURL: "...",
    projectId: "...",
    storageBucket: "...",
    messagingSenderId: "...",
    appId: "..."
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const tg = window.Telegram.WebApp;

// Global Variables
let currentUser = null;
let userProfile = {};
let gameCards = {};
let energyInterval = null;
const ENERGY_REGEN_RATE_PER_SECOND = 0.5; // Saniy…ôd…ô 0.5 enerji (2 saniy…ôd…ô 1)
const OFFLINE_EARNINGS_CAP_HOURS = 3;

// UI Elements
const balanceEl = document.getElementById('balance');
const energyBarEl = document.getElementById('energy-bar');
const energyTextEl = document.getElementById('energy-text-value');
const profitPerHourEl = document.getElementById('profit-per-hour');
const clickableArea = document.getElementById('clickable-area');
const greetingEl = document.getElementById('user-greeting-text');
const upgradeCardsContainer = document.getElementById('upgrade-cards-container');

  // Hƒ∞SS∆è 8: Oyunun Ba≈üladƒ±lmasƒ± (Initialization)

document.addEventListener('DOMContentLoaded', () => {
    tg.ready();
    tg.expand(); // T…ôtbiqi tam ekrana a√ßƒ±r

    if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
        currentUser = tg.initDataUnsafe.user;
        initGame(currentUser);
    } else {
        // Test √º√ß√ºn (Telegram xaricind…ô)
        // currentUser = { id: 12345, first_name: 'Test User' }; 
        // initGame(currentUser);
        document.body.innerHTML = "<h1>Z…ôhm…ôt olmasa, bu oyunu Telegram vasit…ôsil…ô a√ßƒ±n.</h1>";
    }
});

async function initGame(user) {
    greetingEl.textContent = `Salam, ${user.first_name}!`;
    
    const userRef = db.ref(`users/${user.id}`);
    const userSnapshot = await userRef.once('value');

    if (!userSnapshot.exists()) {
        await handleNewUser(user);
    }

    await loadGameData(user.id);
    await calculatePassiveIncome(user.id);
    await loadUpgradeCards();

    attachFirebaseListeners(user.id);
    startEnergyRegen(user.id);
    attachUIListeners();
}

async function handleNewUser(user) {
    const initialProfile = {
        info: {
            id: user.id,
            first_name: user.first_name,
            username: user.username || '',
            createdAt: firebase.database.ServerValue.TIMESTAMP
        },
        game_data: {
            coins: 5000,
            energy_max: 500,
            energy_current: 500,
            profit_per_hour: 0,
            last_active: firebase.database.ServerValue.TIMESTAMP
        },
        purchased_cards: {}
    };
    await db.ref(`users/${user.id}`).set(initialProfile);
}

async function loadGameData(uid) {
    const snapshot = await db.ref(`users/${uid}/game_data`).once('value');
    userProfile = snapshot.val() || {};
    // Ensure defaults if fields are missing
    userProfile.coins = userProfile.coins || 0;
    userProfile.energy_max = userProfile.energy_max || 500;
    userProfile.energy_current = userProfile.energy_current ?? 500;
    userProfile.profit_per_hour = userProfile.profit_per_hour || 0;
    updateUI();
      }
  // Hƒ∞SS∆è 9: Passiv G…ôlir v…ô Arxa Plan Prosesl…ôri

async function calculatePassiveIncome(uid) {
    const now = Date.now();
    const lastActive = userProfile.last_active || now;
    const secondsPassed = Math.floor((now - lastActive) / 1000);
    
    const maxSeconds = OFFLINE_EARNINGS_CAP_HOURS * 3600;
    const secondsToCalculate = Math.min(secondsPassed, maxSeconds);

    if (secondsToCalculate > 60 && userProfile.profit_per_hour > 0) { // Yalnƒ±z 1 d…ôqiq…ôd…ôn √ßox ke√ßibs…ô hesabla
        const profitPerSecond = userProfile.profit_per_hour / 3600;
        const earnings = Math.floor(profitPerSecond * secondsToCalculate);

        if (earnings > 0) {
            await db.ref(`users/${uid}/game_data/coins`).set(firebase.database.ServerValue.increment(earnings));
            
            document.getElementById('offline-earnings-text').textContent = 
                `Siz oyunda olmadƒ±ƒüƒ±nƒ±z m√ºdd…ôtd…ô ${earnings.toLocaleString()} coin qazandƒ±nƒ±z!`;
            document.getElementById('offline-earnings-modal').classList.remove('hidden');
        }
    }
    
    // H…ôr oyuna giri≈üte son aktivliyi yenil…ô
    await db.ref(`users/${uid}/game_data/last_active`).set(now);
}

function attachFirebaseListeners(uid) {
    db.ref(`users/${uid}/game_data`).on('value', (snapshot) => {
        userProfile = snapshot.val() || {};
        updateUI();
    });
}

function startEnergyRegen(uid) {
    if (energyInterval) clearInterval(energyInterval);
    
    energyInterval = setInterval(() => {
        if (userProfile.energy_current < userProfile.energy_max) {
            const newEnergy = Math.min(userProfile.energy_max, userProfile.energy_current + 1);
            if(newEnergy > userProfile.energy_current){
                 db.ref(`users/${uid}/game_data/energy_current`).set(newEnergy);
            }
        }
    }, 1000 / ENERGY_REGEN_RATE_PER_SECOND);
}
  // Hƒ∞SS∆è 10: ∆èsas Oyun M…ôntiqi (Klikl…ôm…ô v…ô Yenil…ôm…ô)

function handleTap() {
    if (userProfile.energy_current > 0) {
        const tapValue = 1; // H…ôr klikd…ô 1 coin

        // Optimistic UI update for faster feel
        userProfile.coins += tapValue;
        userProfile.energy_current -= 1;
        updateUI();

        // Update Firebase
        const updates = {};
        updates[`users/${currentUser.id}/game_data/coins`] = firebase.database.ServerValue.increment(tapValue);
        updates[`users/${currentUser.id}/game_data/energy_current`] = firebase.database.ServerValue.increment(-1);
        updates[`users/${currentUser.id}/game_data/last_active`] = Date.now();
        db.ref().update(updates);
    }
}

async function purchaseUpgrade(cardId) {
    const card = gameCards[cardId];
    const userCardSnapshot = await db.ref(`users/${currentUser.id}/purchased_cards/${cardId}`).once('value');
    const userCardLevel = userCardSnapshot.val()?.level || 0;

    if(userCardLevel >= card.max_level) return; // Maksimum s…ôviyy…ôy…ô √ßatƒ±b

    const cost = Math.floor(card.cost_base * Math.pow(card.cost_factor, userCardLevel));

    if (userProfile.coins >= cost) {
        const profitIncrease = card.profit_base; // Sad…ôlik √º√ß√ºn h…ôr s…ôviyy…ôd…ô eyni artƒ±m

        const updates = {};
        updates[`users/${currentUser.id}/game_data/coins`] = firebase.database.ServerValue.increment(-cost);
        updates[`users/${currentUser.id}/purchased_cards/${cardId}/level`] = firebase.database.ServerValue.increment(1);
        updates[`users/${currentUser.id}/game_data/profit_per_hour`] = firebase.database.ServerValue.increment(profitIncrease);
        
        await db.ref().update(updates);
        
        // Kartlar yenid…ôn render edilir
        renderUpgradeCards(); 
    } else {
        alert("Kifay…ôt q…ôd…ôr coin yoxdur!");
    }
  }
  // Hƒ∞SS∆è 11: UI Render Funksiyalarƒ±

function updateUI() {
    balanceEl.textContent = Math.floor(userProfile.coins).toLocaleString();
    profitPerHourEl.textContent = (userProfile.profit_per_hour || 0).toLocaleString();
    
    const energyPercent = (userProfile.energy_current / userProfile.energy_max) * 100;
    energyBarEl.style.width = `${energyPercent}%`;
    energyTextEl.textContent = `${Math.floor(userProfile.energy_current)}/${userProfile.energy_max}`;
}

async function loadUpgradeCards() {
    const snapshot = await db.ref('upgrade_cards').once('value');
    gameCards = snapshot.val() || {};
    await renderUpgradeCards();
}

async function renderUpgradeCards() {
    upgradeCardsContainer.innerHTML = '';
    const activeCategory = document.querySelector('.tab.active').dataset.category;
    
    const userCardsSnapshot = await db.ref(`users/${currentUser.id}/purchased_cards`).once('value');
    const userCards = userCardsSnapshot.val() || {};

    for (const cardId in gameCards) {
        const card = gameCards[cardId];
        if(card.category !== activeCategory) continue;

        const userCardLevel = userCards[cardId]?.level || 0;
        const cost = Math.floor(card.cost_base * Math.pow(card.cost_factor, userCardLevel));

        const cardHTML = `
            <div class="upgrade-card">
                <div class="icon">${card.emoji}</div>
                <div class="details">
                    <div class="name">${card.name}</div>
                    <div class="meta">
                        <span>S…ôviyy…ô: ${userCardLevel}</span> | 
                        <span>G…ôlir: +${card.profit_base}/saat</span>
                    </div>
                    <div class="price">Qiym…ôt: ${cost.toLocaleString()}</div>
                </div>
                <button class="btn-upgrade" data-card-id="${cardId}" ${userCardLevel >= card.max_level ? 'disabled' : ''}>
                    ${userCardLevel >= card.max_level ? 'MAX' : 'Al'}
                </button>
            </div>
        `;
        upgradeCardsContainer.innerHTML += cardHTML;
    }
}
  // Hƒ∞SS∆è 12: UI Hadis…ôl…ôri (Event Listeners) v…ô Son

function attachUIListeners() {
    // Clicker
    clickableArea.addEventListener('click', handleTap);

    // Modal close button
    document.getElementById('close-modal-btn').addEventListener('click', () => {
        document.getElementById('offline-earnings-modal').classList.add('hidden');
    });

    // Navigation
    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', (e) => {
            const pageId = e.currentTarget.dataset.page;
            switchPage(pageId);
        });
    });

    // Upgrade Card Buttons (Event Delegation)
    upgradeCardsContainer.addEventListener('click', (e) => {
        if (e.target.classList.contains('btn-upgrade')) {
            const cardId = e.target.dataset.cardId;
            purchaseUpgrade(cardId);
        }
    });
    
    // Tab switching
    document.querySelectorAll('.tabs .tab').forEach(tab => {
        tab.addEventListener('click', (e) => {
            document.querySelectorAll('.tabs .tab').forEach(t => t.classList.remove('active'));
            e.currentTarget.classList.add('active');
            renderUpgradeCards();
        });
    });
}

function switchPage(pageId) {
    document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');

    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.toggle('active', item.dataset.page === pageId);
    });
}

</script>
</body>
</html>
