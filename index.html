<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Para √áuvalƒ±</title>
<style>
:root{
  --bg1:#0f0c29; --bg2:#302b63; --bg3:#24243e; --card:rgba(255,255,255,0.06);
  --glass:rgba(255,255,255,0.12); --text:#f8fafc; --accent:#22c55e; --red:#dc2626;
}
*{box-sizing:border-box;margin:0;padding:0;}
html{height:100%;}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,'Helvetica Neue',Arial,'Apple Color Emoji','Segoe UI Emoji';
  color:var(--text); background:linear-gradient(135deg,var(--bg1),var(--bg2) 50%,var(--bg3));
  display: flex; align-items: center; justify-content: center;
  min-height: 100vh; overflow:hidden;
}
.wrap{display:grid;place-items:center;gap:12px;text-align:center;padding:20px;}
.user-info{font-size:1rem;font-weight:600;opacity:.9;margin-bottom:6px;}
.card{
  position:relative; width:min(60vw,320px); aspect-ratio:1/1; display:grid; place-items:center;
  background: radial-gradient(60% 60% at 50% 30%,var(--glass),transparent 70%),var(--card);
  border:1px solid rgba(255,255,255,0.14); border-radius:24px;
  box-shadow:0 15px 40px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.08);
  backdrop-filter:blur(6px);
}
.bag{font-size:clamp(5rem,18vw,12rem);filter:drop-shadow(0 8px 15px rgba(0,0,0,0.35));user-select:none;animation:float 5s ease-in-out infinite;}
@keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-5px);}}
.balance{margin-top:10px;display:grid;place-items:center;font-weight:700;letter-spacing:1px;text-shadow:0 2px 5px rgba(0,0,0,0.5);}
.balance .symbol{font-size:clamp(1rem,2.5vw,1.5rem);opacity:.9;margin-right:4px;}
.balance .value{font-size:clamp(1.5rem,5vw,2.5rem);line-height:1;}
.google-btn{ margin-top:14px; padding:8px 16px; font-size:0.95rem; background:#4285F4; color:white; border:none; border-radius:8px; cursor:pointer; display:flex; align-items:center; gap:6px; font-weight:600;}
.action-buttons button { position: fixed; right: 20px; padding: 8px 14px; font-size: 0.9rem; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
#payBtn { top: 20px; background: #22c55e; }
#cekBtn { top: 58px; background: #2563eb; }
#pulCekBtn { top: 96px; background: #f59e0b; }
#notification-bell { position: fixed; top: 20px; left: 20px; font-size: 28px; cursor: pointer; user-select: none; z-index: 10000; }
#notification-badge { position: absolute; top: -5px; right: -8px; background: #ef4444; color: white; width: 20px; height: 20px; border-radius: 50%; display: none; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; }
.modalOverlay{ position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index:9999; display:none; }
.modalContent{ background:linear-gradient(135deg,var(--bg1),var(--bg2)); padding:20px; border-radius:12px; text-align:center; color:white; width: min(90vw, 350px); }
.modalContent input { display: block; width: 95%; margin: 10px auto; padding: 10px; border-radius: 5px; border: 1px solid rgba(255, 255, 255, 0.2); background: #FFFFFF; color: #212529; font-size: 1rem; }
.modalContent button { margin-top:12px; padding:8px 16px; font-size:1rem; border:none; border-radius:8px; cursor:pointer; }
#announcements-container { margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; }
.announcement-item { background: rgba(14, 165, 233, 0.1); border-left: 4px solid #0ea5e9; padding: 12px; border-radius: 6px; text-align: left; margin-bottom: 10px; }
.announcement-text { font-size: 0.9rem; margin: 0; white-space: pre-wrap; word-break: break-word; }
.announcement-meta { font-size: 0.75rem; opacity: 0.7; margin-top: 8px; text-align: right; }
#notifications-list { max-height: 350px; overflow-y: auto; text-align: left; padding: 5px; background: rgba(0,0,0,0.2); border-radius: 8px; }
.notification-item { background: rgba(255,255,255,0.05); padding: 12px; border-radius: 6px; margin-bottom: 8px; font-size: 0.9rem; border-left: 4px solid #555; }
.notification-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.notification-item-amount { font-size: 1.1rem; font-weight: bold; }
.notification-item-amount.positive { color: #22c55e; } .notification-item-amount.negative { color: #fca5a5; }
.notification-item-status { font-weight: bold; padding: 4px 8px; border-radius: 6px; color: white; font-size: 0.8rem;}
.notification-item-body { font-size: 0.85rem; opacity: 0.8; display: flex; justify-content: space-between; align-items: center; }
.notification-item-footer { font-size: 0.75rem; opacity: 0.7; margin-top: 8px; text-align: right; }
.status-pending { border-left-color: #f59e0b; } .status-pending .notification-item-status { background-color: #f59e0b; }
.status-approved { border-left-color: #16a34a; } .status-approved .notification-item-status { background-color: #16a34a; }
.status-rejected { border-left-color: #dc2626; } .status-rejected .notification-item-status { background-color: #dc2626; }
.status-cancelled { border-left-color: #6b7280; } .status-cancelled .notification-item-status { background-color: #6b7280; }
.status-deposit { border-left-color: #3b82f6; } .status-deposit .notification-item-status { background-color: #3b82f6; }
.cancel-btn { background: var(--red); color: white; border: none; padding: 4px 8px; border-radius: 5px; cursor: pointer; font-size: 0.8rem; font-weight: 600; }
#support-widget { position: fixed; bottom: 20px; right: 20px; z-index: 10000; }
#chat-toggle-btn { background: #0ea5e9; color: white; width: 60px; height: 60px; border-radius: 50%; border: none; font-size: 28px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3); position: relative; }
#chat-notification-badge { position: absolute; top: 0px; right: 0px; background: #ef4444; color: white; min-width: 22px; height: 22px; border-radius: 50%; display: none; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; padding: 2px; }
#chat-window { position: absolute; bottom: 80px; right: 0; width: 320px; max-width: 90vw; height: 400px; background: var(--bg3); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; display: none; flex-direction: column; overflow: hidden; }
#chat-header { padding: 10px; background: rgba(0,0,0,0.2); font-weight: bold; text-align: center; }
#chat-messages { flex-grow: 1; padding: 10px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; }
.message { max-width: 80%; padding: 8px 12px; border-radius: 10px; line-height: 1.4; word-break: break-word; }
.message.user { background: #2563eb; color: white; align-self: flex-end; }
.message.admin { background: #4b5563; color: white; align-self: flex-start; }
#chat-input-area { display: flex; padding: 10px; border-top: 1px solid rgba(255,255,255,0.1); }
#chat-input { flex-grow: 1; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; padding: 8px; color: white; }
#send-chat-btn { background: #0ea5e9; color: white; border: none; padding: 0 12px; border-radius: 6px; margin-left: 8px; cursor: pointer; font-weight: bold; }
#preloader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg1); z-index: 10001; transition: opacity 1s ease-in-out; }
#animated-bag { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: clamp(5rem,18vw,12rem); z-index: 10002; opacity: 0; filter: drop-shadow(0 8px 15px rgba(0,0,0,0.35)); }
.content-wrapper { opacity: 0; visibility: hidden; transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out; }
.balance-update-text { animation: text-flash 0.7s ease-in-out; }
@keyframes text-flash { 0% { color: var(--text); transform: scale(1); } 50% { color: var(--accent); transform: scale(1.2); text-shadow: 0 0 10px var(--accent); } 100% { color: var(--text); transform: scale(1); } }
.coin { position: fixed; top: -50px; font-size: 2rem; z-index: 9998; pointer-events: none; animation-name: fall-and-fade; animation-timing-function: cubic-bezier(0.55, 0.085, 0.68, 0.53); animation-fill-mode: forwards; }
@keyframes fall-and-fade { from { transform: translateY(0) rotateZ(0deg); opacity: 1; } to { transform: translateY(65vh) rotateZ(360deg); opacity: 0; } }
</style>
</head>
<body>
<div id="preloader"></div>
<div id="animated-bag">üí∞</div>
<div class="content-wrapper">
    <div id="notification-bell"><span>üîî</span><div id="notification-badge" style="display:none;">1</div></div>
    <div class="wrap"><div id="userInfo" class="user-info"></div><div class="card"><div class="bag">üí∞</div><div class="balance"><span class="symbol">AZN</span><span id="balance" class="value">0.00</span></div></div><button class="google-btn" id="loginBtn">üåê Giri≈ü</button></div>
    <div class="action-buttons"><button id="payBtn">üí≤ Y√úKL∆è</button><button id="cekBtn">üì∑ √áEK</button><button id="pulCekBtn">üè¶ √áEK</button></div>
    <div class="modalOverlay" id="payModal"><div class="modalContent"><p>üí≤ PUL Y√úKL∆è M10 077 543 50 53</p><button class="close-modal-btn">Baƒüla</button></div></div>
    <div class="modalOverlay" id="cekModal"><div class="modalContent"><p>√á∆èKƒ∞N ≈û∆èKLƒ∞Nƒ∞ G√ñND∆èRM∆èY∆è BAS</p><button id="sendCekBtn">G√ñND∆èR</button><button class="close-modal-btn">Baƒüla</button></div></div>
    <div class="modalOverlay" id="pulCekModal"><div class="modalContent"><h3>Pul √áƒ±xarma Sorƒüusu</h3><input type="number" id="withdrawAmount" placeholder="M…ôbl…ôƒü (AZN)" required><input type="text" id="userName" placeholder="Ad" required><input type="text" id="userSurname" placeholder="Soyad" required><input type="tel" id="cardNumber" placeholder="Kart n√∂mr…ôsi (16 r…ôq…ôm)" maxlength="16" required><button id="withdrawBtn">üí∏ PUL √áIXART</button><button class="close-modal-btn">Baƒüla</button></div></div>
    <div class="modalOverlay" id="notificationsModal"><div class="modalContent"><h3>Hesab √áƒ±xarƒ±≈üƒ± v…ô Elanlar</h3><div id="announcements-container"></div><div id="notifications-list"></div><button class="close-modal-btn">Baƒüla</button></div></div>
    <div id="support-widget"><div id="chat-window"><div id="chat-header">D…ôst…ôk</div><div id="chat-messages"></div><div id="chat-input-area"><input type="text" id="chat-input" placeholder="Mesajƒ±nƒ±zƒ± yazƒ±n..."><button id="send-chat-btn"> g√∂nd…ôr</button></div></div><button id="chat-toggle-btn"><span>üí¨</span><div id="chat-notification-badge" style="display:none;"></div></button></div>
</div>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database-compat.js"></script>
<script>
    const firebaseConfig = { apiKey: "AIzaSyC4sGTK_P4KperVswrxxmt69H5cocsgnNw", authDomain: "niceuc-e5986.firebaseapp.com", databaseURL: "https://niceuc-e5986-default-rtdb.firebaseio.com", projectId: "niceuc-e5986", appId: "1:242221260650:web:d140153a2167c4738dcf13" };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    let balanceListener = null, chatStateListener = null, messageListener = null, userStatusListener = null;

    auth.onAuthStateChanged(user => {
        const supportWidget = document.getElementById('support-widget');
        let lastKnownBalance = 0;

        if (user) {
            if(userStatusListener) userStatusListener.off(); // K√∂hn…ô listener-i s√∂nd√ºr
            
            // ƒ∞stifad…ô√ßinin statusunu real zamanlƒ± izl…ôyirik
            userStatusListener = db.ref('users/' + user.uid).on('value', snapshot => {
                const userData = snapshot.val();
                
                // ∆èg…ôr istifad…ô√ßi dondurulubsa v…ô h…ôl…ô d…ô sistemd…ôdirs…ô, d…ôrhal √ßƒ±xart
                if (userData && userData.isSuspended) {
                    if(auth.currentUser) { 
                        alert("Hesabƒ±nƒ±z admin t…ôr…ôfind…ôn dondurulduƒüu √º√ß√ºn sistemd…ôn √ßƒ±xarƒ±lƒ±rsƒ±nƒ±z.");
                        auth.signOut();
                    }
                    return;
                }

                // ∆èg…ôr istifad…ô√ßi m…ôlumatlarƒ± h…ôl…ô y√ºkl…ônm…ôyibs…ô, y√ºkl…ô
                if (!document.getElementById('userInfo').textContent.includes(user.displayName)) {
                    document.getElementById('userInfo').textContent = `Salam, ${user.displayName}`;
                    db.ref('users/' + user.uid).update({ displayName: user.displayName, email: user.email });

                    if (balanceListener) balanceListener.off();
                    balanceListener = db.ref('balances/' + user.uid).on('value', balanceSnapshot => {
                        const balanceData = balanceSnapshot.val();
                        let newBalance = (balanceData && typeof balanceData.amount === 'number') ? balanceData.amount : 0;
                        const balanceElement = document.getElementById('balance');
                        if (newBalance > lastKnownBalance && lastKnownBalance !== 0) {
                            createCoinShower();
                            balanceElement.classList.add('balance-update-text');
                            balanceElement.addEventListener('animationend', () => balanceElement.classList.remove('balance-update-text'), { once: true });
                            animateCountUp(balanceElement, lastKnownBalance, newBalance, 1200);
                        } else {
                            balanceElement.textContent = newBalance.toFixed(2);
                        }
                        lastKnownBalance = newBalance;
                    });

                    supportWidget.style.display = 'block';
                    initializeSupportChat(user);
                }
            });
        } else {
            // ƒ∞stifad…ô√ßi √ßƒ±xƒ±≈ü etdikd…ô h…ôr ≈üeyi sƒ±fƒ±rla
            document.getElementById('userInfo').textContent = '';
            document.getElementById('balance').textContent = '0.00';
            lastKnownBalance = 0;
            if (balanceListener) balanceListener.off();
            if (chatStateListener) chatStateListener.off();
            if (messageListener) messageListener.off();
            if(userStatusListener) userStatusListener.off();
            supportWidget.style.display = 'none';
        }
    });
    
    function animateCountUp(element, start, end, duration) { let startTime = null; const step = (timestamp) => { if (!startTime) startTime = timestamp; const progress = Math.min((timestamp - startTime) / duration, 1); const current = start + progress * (end - start); element.textContent = current.toFixed(2); if (progress < 1) { window.requestAnimationFrame(step); } }; window.requestAnimationFrame(step); }
    function createCoinShower() { const coinCount = 10; const body = document.body; for (let i = 0; i < coinCount; i++) { const coin = document.createElement('span'); coin.className = 'coin'; coin.innerHTML = 'ü™ô'; coin.style.left = `${Math.random() * 95}vw`; coin.style.animationDuration = `${Math.random() * 0.8 + 0.6}s`; coin.style.animationDelay = `${Math.random() * 0.4}s`; body.appendChild(coin); setTimeout(() => { coin.remove(); }, 2000); } }
    function cancelWithdrawal(withdrawalId, amount) { const parsedAmount = parseFloat(amount); if (!confirm(`${parsedAmount.toFixed(2)} AZN m…ôbl…ôƒüind…ôki √ßƒ±xarƒ±≈ü sorƒüusunu l…ôƒüv etm…ôk ist…ôdiyiniz…ô …ôminsiniz? M…ôbl…ôƒü balansƒ±nƒ±za geri qaytarƒ±lacaq.`)) { return; } const user = auth.currentUser; if (!user) return alert("X…ôta: ƒ∞stifad…ô√ßi tapƒ±lmadƒ±."); const withdrawalRef = db.ref(`withdrawals/${withdrawalId}`); withdrawalRef.once('value').then(snapshot => { const request = snapshot.val(); if (!request || request.status !== 'pending') { alert("Bu sorƒüu artƒ±q emal edilib v…ô l…ôƒüv edil…ô bilm…ôz."); return; } const updates = {}; updates[`/withdrawals/${withdrawalId}/status`] = 'cancelled'; updates[`/balances/${user.uid}/amount`] = firebase.database.ServerValue.increment(parsedAmount); db.ref().update(updates).then(() => { alert("Sorƒüunuz l…ôƒüv edildi."); const modal = document.getElementById('notificationsModal'); if (modal.style.display === 'flex') { modal.style.display = 'none'; setTimeout(() => document.getElementById('notification-bell').click(), 200); } }).catch(e => alert("X…ôta: " + e.message)); }); }
    document.getElementById('loginBtn').addEventListener('click', () => { const p = new firebase.auth.GoogleAuthProvider(); auth.signInWithPopup(p).catch(e => alert(e.message)); });
    document.getElementById('payBtn').addEventListener('click', () => document.getElementById('payModal').style.display = 'flex');
    document.getElementById('cekBtn').addEventListener('click', () => document.getElementById('cekModal').style.display = 'flex');
    document.getElementById('pulCekBtn').addEventListener('click', () => document.getElementById('pulCekModal').style.display = 'flex');
    document.querySelectorAll('.close-modal-btn').forEach(b => b.addEventListener('click', (e) => e.target.closest('.modalOverlay').style.display = 'none'));
    document.getElementById('sendCekBtn').addEventListener('click', () => { window.open(`https://wa.me/+994513239857?text=${encodeURIComponent('√áEKƒ∞ G√ñND∆èRƒ∞R∆èM')}`, '_blank'); document.getElementById('cekModal').style.display = 'none'; });
    document.getElementById('notification-bell').addEventListener('click', () => { const user = auth.currentUser; if (!user) return alert('Daxil olun.'); const modal = document.getElementById('notificationsModal'); const list = document.getElementById('notifications-list'); const announcementsContainer = document.getElementById('announcements-container'); modal.style.display = 'flex'; list.innerHTML = '<p>Y√ºkl…ônir...</p>'; announcementsContainer.innerHTML = ''; const refs = [db.ref('withdrawals').orderByChild('uid').equalTo(user.uid).limitToLast(30).once('value'), db.ref('deposits').orderByChild('uid').equalTo(user.uid).limitToLast(30).once('value'), db.ref('announcements').limitToLast(5).once('value')]; Promise.all(refs).then(([w, d, a]) => { if (a.exists()) { let an = []; a.forEach(c => an.push(c.val())); an.reverse().forEach(ann => { const ad = document.createElement('div'); ad.className = 'announcement-item'; ad.innerHTML = `<p class="announcement-text">${ann.text}</p><div class="announcement-meta">${new Date(ann.createdAt).toLocaleDateString()}</div>`; announcementsContainer.appendChild(ad); }); } if (!w.exists() && !d.exists()) { list.innerHTML = '<p>∆èm…ôliyyat tapƒ±lmadƒ±.</p>'; return; } let all = []; w.forEach(c => all.push({ key: c.key, ...c.val() })); d.forEach(c => all.push({ ...c.val(), type: 'deposit' })); all.sort((a, b) => b.createdAt - a.createdAt); list.innerHTML = ''; all.forEach(data => { const i = document.createElement('div'); if (data.type === 'deposit') { i.className = 'notification-item status-deposit'; i.innerHTML = `<div class="notification-item-header"><span class="notification-item-amount positive">+${parseFloat(data.amount).toFixed(2)} AZN</span><span class="notification-item-status">M…ôdaxil</span></div><div class="notification-item-body"><span>Balansƒ±nƒ±za v…ôsait …ôlav…ô edildi.</span></div><div class="notification-item-footer">${new Date(data.createdAt).toLocaleString()}</div>`; } else { const rd = data.requestData; let st, sc; switch (data.status) { case 'approved': st = 'Onaylandƒ±'; sc = 'status-approved'; break; case 'rejected': st = 'R…ôdd edildi'; sc = 'status-rejected'; break; case 'pending': st = 'G√∂zl…ôm…ôd…ô'; sc = 'status-pending'; break; case 'cancelled': st = 'L…ôƒüv Edildi'; sc = 'status-cancelled'; break; default: st = data.status; sc = 'status-cancelled'; } let ah = ''; if (data.status === 'pending') ah = `<button class="cancel-btn" onclick="cancelWithdrawal('${data.key}', ${rd.amount})">L…ôƒüv Et</button>`; i.className = `notification-item ${sc}`; const mc = rd.cardNumber ? `**** ${rd.cardNumber.slice(-4)}` : 'Kart yoxdur'; i.innerHTML = `<div class="notification-item-header"><span class="notification-item-amount negative">-${parseFloat(rd.amount).toFixed(2)} AZN</span><span class="notification-item-status">${st}</span></div><div class="notification-item-body"><span>Kart: ${mc}</span> ${ah}</div><div class="notification-item-footer">${new Date(data.createdAt).toLocaleString()}</div>`; } list.appendChild(i); }); }).catch(e => { list.innerHTML = '<p>X…ôta ba≈ü verdi.</p>'; console.error(e); }); });
    document.getElementById('withdrawBtn').addEventListener('click', () => { const user = auth.currentUser; if (!user) return alert('Daxil olun.'); db.ref(`balances/${user.uid}`).once('value', s => { const cb = (s.val() && s.val().amount) || 0; const a = parseFloat(document.getElementById('withdrawAmount').value), n = document.getElementById('userName').value.trim(), sn = document.getElementById('userSurname').value.trim(), c = document.getElementById('cardNumber').value.trim(); if (isNaN(a) || a <= 0 || !n || !sn || !c || c.length !== 16 || isNaN(c)) return alert('B√ºt√ºn xanalarƒ± d√ºzg√ºn doldurun.'); if (a > cb) return alert('Balansƒ±nƒ±zda kifay…ôt q…ôd…ôr v…ôsait yoxdur.'); const br = db.ref(`balances/${user.uid}`); br.transaction(cd => (cd && cd.amount < a) ? undefined : { amount: (cd.amount || 0) - a }, (err, com, snap) => { if (err) return alert(`X…ôta: ${err.message}`); if (!com) return alert('Balansda kifay…ôt q…ôd…ôr v…ôsait yoxdur.'); const req = { uid: user.uid, userEmail: user.email, requestData: { name: n, surname: sn, cardNumber: c, amount: a }, status: 'pending', createdAt: firebase.database.ServerValue.TIMESTAMP }; db.ref('withdrawals').push(req).then(() => { alert('Sorƒüunuz g√∂nd…ôrildi.'); document.getElementById('pulCekModal').style.display = 'none'; ['withdrawAmount', 'userName', 'userSurname', 'cardNumber'].forEach(id => document.getElementById(id).value = ''); }).catch(e => { alert(`X…ôta: ${e.message}`); br.transaction(cd => ({ amount: (cd.amount || 0) + a })); }); }); }); });
    function initializeSupportChat(user) { const cW = document.getElementById('chat-window'), cT = document.getElementById('chat-toggle-btn'), cM = document.getElementById('chat-messages'), cI = document.getElementById('chat-input'), sB = document.getElementById('send-chat-btn'), cB = document.getElementById('chat-notification-badge'); if (messageListener) messageListener.off(); if (chatStateListener) chatStateListener.off(); cT.onclick = () => { const isHidden = cW.style.display === 'none' || cW.style.display === ''; cW.style.display = isHidden ? 'flex' : 'none'; if (isHidden) db.ref(`support_chats/${user.uid}/new_message_for_user_count`).set(0); }; const cRef = db.ref(`support_chats/${user.uid}`); chatStateListener = cRef.on('value', s => { const cnt = s.val()?.new_message_for_user_count || 0; cB.textContent = cnt; cB.style.display = cnt > 0 ? 'flex' : 'none'; }); cM.innerHTML = ''; const mRef = db.ref(`support_chats/${user.uid}/messages`).limitToLast(50); messageListener = mRef.on('child_added', s => { const msg = s.val(), mD = document.createElement('div'); mD.className = `message ${msg.sender === 'admin' ? 'admin' : 'user'}`; mD.textContent = msg.text; cM.appendChild(mD); cM.scrollTop = cM.scrollHeight; }); const send = () => { const txt = cI.value.trim(); if (txt === '') return; const mData = { text: txt, sender: user.uid, timestamp: firebase.database.ServerValue.TIMESTAMP }; db.ref(`support_chats/${user.uid}/messages`).push(mData); db.ref(`support_chats/${user.uid}`).update({ user_email: user.email, last_message: txt, last_updated: firebase.database.ServerValue.TIMESTAMP, new_message_for_admin: true }); cI.value = ''; }; sB.onclick = send; cI.onkeydown = e => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send(); } }; }
    window.onload = function() { const p = document.getElementById('preloader'), aB = document.getElementById('animated-bag'), fB = document.querySelector('.card .bag'), cW = document.querySelector('.content-wrapper'); p.style.opacity = '0'; setTimeout(() => { aB.style.opacity = '1'; aB.style.transition = 'all 1.2s cubic-bezier(0.68, -0.6, 0.32, 1.6)'; }, 200); setTimeout(() => { const r = fB.getBoundingClientRect(); aB.style.left = `${r.left + r.width / 2}px`; aB.style.top = `${r.top + r.height / 2}px`; aB.style.fontSize = getComputedStyle(fB).fontSize; }, 1000); setTimeout(() => { p.style.display = 'none'; aB.style.display = 'none'; cW.style.opacity = '1'; cW.style.visibility = 'visible'; }, 2200); };
</script>
</body>
</html>
